# ワークスペースアイテム編集権限仕様

## 概要

ワークスペースアイテムの編集権限は、アイテムの状態（下書き/公開）とユーザーの役割（オーナー/担当者/その他）によって制御されます。

## 用語定義

| 用語 | 説明 |
|------|------|
| **オーナー** | アイテムを作成したユーザー（`item.ownerId`） |
| **担当者** | アイテムに割り当てられたユーザー（`item.assigneeId`） |
| **下書き** | `item.isDraft === true` の状態 |

## 編集権限マトリクス

| アイテム状態 | オーナー | 担当者 | その他のメンバー |
|-------------|---------|--------|-----------------|
| **通常（公開）** | ✅ 編集可 | ✅ 編集可 | ⚠️ 編集不可（担当者になれば可） |
| **下書き** | ✅ 編集可 | 🚫 編集不可 | 🚫 編集不可 |

## UI 動作仕様

### 通常（公開）アイテムの場合

#### オーナーまたは担当者
- 編集ボタン: **有効**
- クリック時: 編集モーダルが開く

#### その他のメンバー
- 編集ボタン: **有効**
- クリック時:
  1. 警告通知を表示:「アイテムを編集するにはオーナーまたは担当者である必要があります。編集するには担当者になってください。」
  2. 詳細オプションドローワーが自動で開く（担当者を自分に変更できるようにするため）

### 下書きアイテムの場合

#### オーナー
- 編集ボタン: **有効**
- ツールチップ: 「アイテムを編集」
- クリック時: 編集モーダルが開く

#### 担当者・その他のメンバー
- 編集ボタン: **無効（disabled）**
- ツールチップ: 「オーナーが下書き中です」
- クリック不可

## 実装箇所

- **フロントエンド**: `pecus.Frontend/src/app/(dashbord)/workspaces/[code]/WorkspaceItemDetail.tsx`
- **編集モーダル**: `pecus.Frontend/src/app/(dashbord)/workspaces/[code]/EditWorkspaceItem.tsx`
- **担当者変更UI**: `pecus.Frontend/src/app/(dashbord)/workspaces/[code]/WorkspaceItemDrawer.tsx`

## 編集モーダル内の項目表示権限

編集モーダル内の一部の項目は、ユーザーの役割によって表示/非表示が切り替わります。

### 項目表示マトリクス

| 項目 | オーナー | 担当者 | その他 |
|------|---------|--------|--------|
| 件名 | ✅ 表示 | ✅ 表示 | ✅ 表示 |
| 本文 | ✅ 表示 | ✅ 表示 | ✅ 表示 |
| 期限日 | ✅ 表示 | ✅ 表示 | ✅ 表示 |
| 優先度 | ✅ 表示 | ✅ 表示 | ✅ 表示 |
| **下書き** | ✅ 表示 | ❌ 非表示 | ❌ 非表示 |
| **アーカイブ** | ✅ 表示 | ✅ 表示 | ❌ 非表示 |

### 下書きスイッチ（オーナーのみ）

- **表示条件**: `currentUserId === item.ownerId`
- **理由**: 下書き状態はオーナーが公開タイミングを制御するための機能であり、他のユーザーが変更すべきではない

### アーカイブスイッチ（オーナーまたは担当者）

- **表示条件**: `currentUserId === item.ownerId || currentUserId === item.assigneeId`
- **理由**: アーカイブは作業完了を示すフラグであり、実際に作業を行うオーナーまたは担当者が操作すべき

## 設計意図

### 下書き時の制限理由

下書き状態のアイテムは、オーナーが内容を検討・準備中であることを示します。他のユーザーが編集すると以下の問題が発生する可能性があります：

1. オーナーの意図しない変更が加えられる
2. 下書きの一貫性が損なわれる
3. 公開前のレビュープロセスが複雑になる

そのため、下書き中はオーナーのみが編集できる仕様としています。

### 担当者への誘導理由

通常アイテムでオーナー・担当者以外のユーザーが編集しようとした場合、単にエラーを表示するのではなく、担当者になる方法を案内します。これにより：

1. ユーザーが次のアクションを理解できる
2. 不要な問い合わせを減らせる
3. ワークフローがスムーズになる

## 関連仕様

- [ワークスペースアクセス制御](./workspace-access-control.md)
