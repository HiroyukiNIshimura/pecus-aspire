{
  "_comment": "このファイルが設定の唯一のソースです。scripts/generate-appsettings.js で各プロジェクト用に生成されます。",

  "_folders": {
    "_comment": "data ディレクトリ配下のフォルダ名。ベースパスは環境変数 DATA_PATH で指定（開発: AppHost.cs が自動計算、本番: docker-compose.yml で設定）",
    "uploads": "uploads",
    "notifications": "notifications"
  },

  "_infrastructure": {
    "_comment": "Docker/Aspire 共通のインフラ設定（ポート、ホスト名、認証情報など）",
    "postgres": {
      "user": "pecus",
      "password": "P@ssw0rd",
      "db": "pecusdb",
      "port": 5432,
      "image": "groonga/pgroonga:latest-debian-18"
    },
    "redis": {
      "port": 6379,
      "_comment": "バックエンド用 Redis（WebApi, BackFire）"
    },
    "redisFrontend": {
      "port": 6380,
      "_comment": "フロントエンド用 Redis（Next.js セッション管理）"
    },
    "ports": {
      "webapi": 7265,
      "frontend": 3000,
      "backfire": 5010,
      "lexicalConverter": 5100,
      "lexicalConverterMetrics": 9101
    },
    "grpc": {
      "host": "0.0.0.0"
    },
    "urls": {
      "allowDomain": "localhost",
      "frontend": "https://localhost:3000",
      "webapiPublic": "https://localhost:7265",
      "lexicalConverter": "http://localhost:5100"
    },
    "docker": {
      "_comment": "Docker Compose 内部ホスト名（本番用）",
      "lexicalConverterHost": "lexicalconverter",
      "postgresHost": "postgres",
      "redisHost": "redis",
      "redisFrontendHost": "redis-frontend",
      "webapiHost": "pecusapi",
      "frontendHost": "frontend"
    },
    "monitoring": {
      "_comment": "Prometheus 監視設定。enabled: false で設定ファイル生成をスキップ",
      "enabled": true,
      "diskMountPoints": ["/"],
      "prometheus": {
        "port": 9090
      },
      "nodeExporter": {
        "port": 9100
      },
      "blackboxExporter": {
        "port": 9115
      }
    }
  },

  "_shared": {
    "LexicalConverter": {
      "_comment": "URL は _infrastructure.urls.lexicalConverter で管理",
      "GrpcApiKey": "pecus-lexical-internal-key-change-in-production"
    },
    "Email": {
      "SmtpHost": "smtp.example.local",
      "SmtpPort": 587,
      "UseSsl": true,
      "Username": "",
      "Password": "",
      "FromEmail": "noreply@example.local",
      "FromName": "Coati",
      "TemplateRootPath": "Mail/Templates",
      "SendMailInDevelopment": false
    },
    "DeepSeek": {
      "BaseUrl": "https://api.deepseek.com",
      "TimeoutSeconds": 60,
      "DefaultMaxTokens": 2048,
      "DefaultTemperature": 0.7
    },
    "OpenAI": {
      "BaseUrl": "https://api.openai.com/v1",
      "TimeoutSeconds": 60,
      "DefaultMaxTokens": 2048,
      "DefaultTemperature": 0.7,
      "ModelCreatedAfter": "2024-01-01"
    },
    "Anthropic": {
      "BaseUrl": "https://api.anthropic.com/v1",
      "ApiVersion": "2023-06-01",
      "TimeoutSeconds": 60,
      "DefaultMaxTokens": 2048,
      "DefaultTemperature": 0.7
    },
    "Gemini": {
      "BaseUrl": "https://generativelanguage.googleapis.com/v1beta",
      "TimeoutSeconds": 60,
      "DefaultMaxTokens": 2048,
      "DefaultTemperature": 0.7
    },
    "Kimi": {
      "BaseUrl": "https://api.moonshot.ai/v1",
      "TimeoutSeconds": 120,
      "DefaultMaxTokens": 4096,
      "DefaultTemperature": 0.7
    },
    "DefaultAi": {
      "Provider": "DeepSeek",
      "Model": "deepseek-chat",
      "ApiKey": "CHANGE_ME_AI_API_KEY"
    },
    "Application": {
      "Name": "Coati",
      "Version": "1.0.0",
      "SiteUrl": "https://coati.bright-l.0am.jp",
      "CompanyName": "Bright-L Co., Ltd."
    }
  },

  "webapi": {
    "Logging": {
      "LogLevel": {
        "Default": "Information",
        "Microsoft.AspNetCore": "Warning",
        "Microsoft.EntityFrameworkCore.Database.Command": "Warning"
      }
    },
    "AllowedHosts": "*",
    "Pecus": {
      "Jwt": {
        "IssuerSigningKey": "P8v9IoORqBUelu6dxWXMfmKtnyjG1NhZ4awCT7EcQAbDi0zLgrY2s5pFkSJHV3",
        "ValidIssuer": "http://localhost/",
        "ValidAudience": "https://localhost/",
        "ExpiresMinutes": 15
      },
      "Pagination": {
        "DefaultPageSize": 20,
        "MaxPageSize": 100
      },
      "Limits": {
        "_comment":"今はプランの差はつけていないが、将来のために分けている。プランごとの制限値を変えたい場合はここを編集する。",
        "Free":{
          "MaxTagsPerOrganization": 1000,
          "MaxSkillsPerOrganization": 100,
          "MaxDocumentsPerWorkspace": 500,
          "MaxAttendeesPerAgenda": 100,
          "MaxTasksPerItem": 50
        },
        "Standard":{
          "MaxTagsPerOrganization": 1000,
          "MaxSkillsPerOrganization": 100,
          "MaxDocumentsPerWorkspace": 500,
          "MaxAttendeesPerAgenda": 100,
          "MaxTasksPerItem": 50
        },
        "Enterprise":{
          "MaxTagsPerOrganization": 1000,
          "MaxSkillsPerOrganization": 100,
          "MaxDocumentsPerWorkspace": 500,
          "MaxAttendeesPerAgenda": 100,
          "MaxTasksPerItem": 50
        }
      },
      "FileUpload": {
        "MaxFileSize": 5242880,
        "AllowedImageExtensions": [".jpg", ".jpeg", ".png", ".gif", ".webp"],
        "AllowedMimeTypes": ["image/jpeg", "image/png", "image/gif", "image/webp"],
        "MaxAttachmentFileSize": 20971520,
        "AllowedAttachmentExtensions": [
          ".jpg", ".jpeg", ".png", ".gif", ".webp",
          ".pdf", ".doc", ".docx", ".xls", ".xlsx", ".ppt", ".pptx",
          ".txt", ".csv", ".zip", ".rar"
        ],
        "AllowedAttachmentMimeTypes": [
          "image/jpeg", "image/png", "image/gif", "image/webp",
          "application/pdf",
          "application/msword",
          "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
          "application/vnd.ms-excel",
          "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
          "application/vnd.ms-powerpoint",
          "application/vnd.openxmlformats-officedocument.presentationml.presentation",
          "text/plain", "text/csv",
          "application/zip", "application/x-rar-compressed"
        ],
        "ThumbnailMediumSize": 800,
        "ThumbnailSmallSize": 200
      }
    },
    "Security": {
      "AllowedFrontendUrls": [
        "https://localhost:3000",
        "http://localhost:3000"
      ]
    }
  },

  "backfire": {
    "_comment": "WorkerPerCore は Hangfire サーバーのワーカー数を CPU コア数に乗算する値です。WorkerPerCore * CPUコア数 = ワーカー数が運用する際の組織数を下回らないよう設定するのが望ましいです。",
    "WorkerPerCore": 3,
    "Logging": {
      "LogLevel": {
        "Default": "Information",
        "Microsoft.AspNetCore": "Warning",
        "Microsoft.EntityFrameworkCore.Database.Command": "Warning"
      }
    },
    "RefreshTokenCleanup": {
      "Enabled": true,
      "BatchSize": 1000,
      "OlderThanDays": 30,
      "CronExpression": "0 2 * * *"
    },
    "DeviceCleanup": {
      "Enabled": true,
      "BatchSize": 1000,
      "OlderThanDays": 30,
      "VeryOldDays": 365,
      "CronExpression": "15 2 * * *"
    },
    "EmailChangeTokenCleanup": {
      "Enabled": true,
      "BatchSize": 1000,
      "OlderThanDays": 7,
      "CronExpression": "0 3 * * *"
    },
    "UploadsCleanup": {
      "Enabled": true,
      "TempRetentionHours": 24,
      "CronExpression": "0 4 * * *"
    },
    "ChatCleanup": {
      "Enabled": true,
      "BatchSize": 1000,
      "System": { "OlderThanDays": 40 },
      "Group": { "OlderThanDays": 120 },
      "Dm": { "OlderThanDays": 380 },
      "Ai": { "OlderThanDays": 40 },
      "CronExpression": "0 5 * * *"
    },
    "WeeklyReport": {
      "Enabled": true,
      "DeliveryHour": 8,
      "DeliveryMinute": 0
    },
    "SystemNotification": {
      "Enabled": true,
      "CronExpression": "30 * * * *"
    },
    "AchievementEvaluation": {
      "Enabled": true,
      "CronExpression": "0 3 * * *"
    },
    "AgendaReminder": {
      "Enabled": true,
      "CronExpression": "*/5 * * * *",
      "CutoffMinutes": 0
    },
    "AgendaCleanup": {
      "Enabled": true,
      "BatchSize": 1000,
      "OlderThanDays": 0,
      "CronExpression": "0 6 * * *"
    },
    "ExternalApiKeyCleanup": {
      "Enabled": true,
      "BatchSize": 1000,
      "OlderThanDays": 30,
      "CronExpression": "30 2 * * *"
    },
    "AgendaEmail": {
      "Enabled": true,
      "CronExpression": "*/5 * * * *"
    },
    "LandingPageRecommendation": {
      "Enabled": true,
      "CronExpression": "0 4 * * 1"
    }
  },

  "dbmanager": {
    "AllowedHosts": "*",
    "BackOffice": {
      "Organization": {
        "Name": "System Maintenance",
        "Code": "SYS-MAINT-001",
        "PhoneNumber": "000-0000-0000",
        "Email": "admin@backoffice.none"
      },
      "Users": [
        {
          "Email": "admin@backoffice.none",
          "Username": "BackOffice Admin",
          "Password": "P@ssw0rd"
        }
      ]
    },
    "DemoMode": {
      "Enabled": true,
      "Organization": {
        "Name": "株式会社デモコアティ",
        "Code": "DEMO-001",
        "PhoneNumber": "000-0000-0000",
        "Email": "admin@demo.coati.none",
        "GenerativeApiVendor": "DeepSeek",
        "GenerativeApiKey": "CHANGE_ME_AI_API_KEY",
        "GenerativeApiModel": "deepseek-chat"
      },
      "Users": [
        {
          "Email": "admin@demo.coati.none",
          "Username": "小当 管理",
          "Password": "P@ssw0rd",
          "Role": "Admin"
        },
        {
          "Email": "user1@demo.coati.none",
          "Username": "子宛 一郎",
          "Password": "P@ssw0rd",
          "Role": "User"
        },
        {
          "Email": "user2@demo.coati.none",
          "Username": "個宛 二郎",
          "Password": "P@ssw0rd",
          "Role": "User"
        },
        {
          "Email": "user3@demo.coati.none",
          "Username": "小当 三郎",
          "Password": "P@ssw0rd",
          "Role": "User"
        }
      ]
    }
  }
}
