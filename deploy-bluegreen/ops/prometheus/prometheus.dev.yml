# ============================================
# Prometheus Configuration (Development/Aspire)
#
# 開発環境用: host.docker.internal 経由でローカルサービスに接続
# ターゲットは file_sd_config で管理（本番と同じ形式）
# ============================================

global:
  scrape_interval: 15s
  evaluation_interval: 15s

scrape_configs:
  # ----------------------------------------
  # Prometheus 自身
  # ----------------------------------------
  - job_name: "prometheus"
    static_configs:
      - targets: ['localhost:9090']

  # ----------------------------------------
  # Backend (.NET WebAPI) - HTTPS + 自己署名証明書
  # ----------------------------------------
  - job_name: "backend"
    metrics_path: /metrics
    scheme: https
    tls_config:
      insecure_skip_verify: true
    file_sd_configs:
      - files:
          - '/etc/prometheus/targets/backend.json'
        refresh_interval: 30s

  # ----------------------------------------
  # Frontend (Next.js)
  # ----------------------------------------
  - job_name: "frontend"
    metrics_path: /api/metrics
    file_sd_configs:
      - files:
          - '/etc/prometheus/targets/frontend.json'
        refresh_interval: 30s

  # ----------------------------------------
  # LexicalConverter (NestJS gRPC)
  # ----------------------------------------
  - job_name: "lexicalconverter"
    metrics_path: /metrics
    file_sd_configs:
      - files:
          - '/etc/prometheus/targets/infra.json'
        refresh_interval: 30s
