#!/bin/sh
set -eu

# ================================================================================
# フレッシュデプロイスクリプト（DBリセット付き）
# ================================================================================
# 用途: DBを初期化してからデプロイを実行
# 実行タイミング: 初期セットアップ、DBスキーマの破壊的変更時
#
# 内部で pull-and-deploy.sh --db-reset を実行します。
# ================================================================================

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"

echo "========================================="
echo "  🆕 フレッシュデプロイ（DBリセット付き）"
echo "========================================="
echo ""
echo "このスクリプトは以下を実行します:"
echo "  1. ビルドPCから最新イメージをプル"
echo "  2. アプリケーションを停止"
echo "  3. データベースを完全にリセット（全データ削除）"
echo "  4. マイグレーションを実行"
echo "  5. Blue-Greenデプロイを実行"
echo ""

# 全ての引数を透過的に渡し、--db-reset を追加
exec "$SCRIPT_DIR/pull-and-deploy.sh" "$@" --db-reset
